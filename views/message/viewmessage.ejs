<% include ../partials/header %>

<html>


	<div id="message" class="container displayList">
		Talking To: <%= talkingto %>
		<%for(var i=0;i<currentUser.messageLog.length;i++){ %>
			<li class="list-group-item d-flex justify-content-between align-items-center">
				<% if(currentUser.messageLog[i].sendTo==talkingto && currentUser.messageLog[i].sender==currentUser.username){ %>
						<%= currentUser.username %>: <%= currentUser.messageLog[i].message %>
				<% } %>
				<% if(currentUser.messageLog[i].sender==talkingto){ %>
						<%= talkingto %>: <%= currentUser.messageLog[i].message %>
				<% } %>
			</li>
		<% } %>
		<form action="/message" method="POST">
			<textarea name="message"  placeholder="Message"/></textarea><br />
			<input style="display:none;" name="sendTo" value=<%= talkingto %> />
			<button id="send">Send</button>
		</form>
	</div>
	<script>
		var socket = io();
		$(() => {
			$("#send").click(()=>{
				//sendMessage({name: $("#name").val(), message: $("#message").val()});
				console.log("click");
			})

		})
		//	socket.on('message', test)
			socket.on('message', addMessages)
		function test(){
			console.log("Yahzee");
		}

		function test(){
			console.log("We are connected");
		}
		function addMessages(message){
			$("#messages").append('<h4> ${message.name} </h4> <p> test </p>')
		}
		function getMessages(){
		  $.get('http://localhost:3000/messages', (data) => {
			data.forEach(addMessages);
		  })
		}
		function sendMessage(message){
		  $.post('http://localhost:3000/messages', message)
		}
	</script>
</html>

<% include ../partials/footer %>
